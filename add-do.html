<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>➕ Thêm / Chỉnh sửa sản phẩm</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <a href="index.html" class="back-link">◀ Quay lại</a>
  <h1>➕ Thêm / Chỉnh sửa sản phẩm</h1>

  <div class="form-card">
    <label>Tên sản phẩm
      <input id="name" type="text" placeholder="Ví dụ: Ghế sofa 2 chỗ">
    </label>

    <label>Danh mục
      <select id="category">
        <option value="Phòng khách">Phòng khách</option>
        <option value="Phòng ngủ">Phòng ngủ</option>
        <option value="Phòng bếp">Phòng bếp</option>
        <option value="Phòng tắm">Phòng tắm</option>
        <option value="Văn phòng">Văn phòng</option>
        <option value="Trang trí">Trang trí</option>
      </select>
    </label>

    <label>Giá (VNĐ)
      <input id="price" type="number" placeholder="Ví dụ: 2500000">
    </label>

    <label>Link hình ảnh
      <input id="image" type="text" placeholder="URL hình ảnh">
    </label>

    <label>Mô tả
      <textarea id="desc" rows="6" placeholder="Mô tả chi tiết sản phẩm..."></textarea>
    </label>

    <div class="form-actions" style="margin-top:10px;">
      <button class="btn ghost" onclick="location.href='index.html'">Hủy</button>
      <button class="btn" onclick="saveProduct()">Lưu sản phẩm</button>
    </div>
  </div>
</div>

<script>
const id = new URLSearchParams(location.search).get("id");
let products = JSON.parse(localStorage.getItem("products") || "[]");
let currentUser = JSON.parse(localStorage.getItem("currentUser") || "{}");
if(!currentUser.username){ alert("Bạn phải đăng nhập!"); location.href="login.html"; }

function loadEdit(){
  if(!id) return;
  const p = products.find(x=>x.id===id);
  if(!p) return;
  document.getElementById("name").value = p.name;
  document.getElementById("category").value = p.category;
  document.getElementById("price").value = p.price;
  document.getElementById("image").value = p.image;
  document.getElementById("desc").value = p.desc;
}
loadEdit();

function saveProduct(){
  const name = document.getElementById("name").value.trim();
  const category = document.getElementById("category").value;
  const price = document.getElementById("price").value.trim();
  const image = document.getElementById("image").value.trim();
  const desc = document.getElementById("desc").value.trim();
  if(!name) return alert("Tên sản phẩm không được để trống!");

  if(id){
    const index = products.findIndex(p=>p.id===id);
    products[index] = {...products[index], name, category, price, image, desc};
  } else {
    const newProduct = {id:"p"+(products.length+1), name, category, price, image, desc, creator:currentUser.username};
    products.push(newProduct);
  }
  localStorage.setItem("products", JSON.stringify(products));
  alert("Lưu thành công!");
  location.href="index.html";
}
</script>
</body>
</html>
