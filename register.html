<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Đăng ký - Đồ Nội Thất Store</title>
  <style>
    :root { --muted:#666; }

    body {
      margin:0;
      font-family: Inter, Arial, sans-serif;
      background:#fff7ec;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
    }

    .login-box {
      background:#fff;
      padding:24px;
      border-radius:12px;
      box-shadow:0 10px 30px rgba(0,0,0,.1);
      width:100%;
      max-width:360px;
      text-align:center;
    }

    .login-header h1 {
      font-size:22px;
      margin-bottom:16px;
      color:#333;
    }

    .login-form input {
      width:100%;
      padding:10px;
      margin-bottom:12px;
      border:1px solid #ccc;
      border-radius:8px;
      font-size:14px;
    }

    .btn {
      width:100%;
      padding:10px;
      margin-bottom:8px;
      border:none;
      border-radius:8px;
      background:#ff7a00;
      color:#fff;
      font-weight:bold;
      cursor:pointer;
      transition:opacity .3s;
    }

    .btn:hover { opacity:.9; }

    .btn.ghost {
      background:#fff;
      border:2px solid #111;
      color:#111;
    }

    .small-muted {
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
    }
  </style>
</head>
<body>
  <div class="login-box">
    <div class="login-header"><h1>Đăng ký</h1></div>
    <form class="login-form">
      <input id="fullname" type="text" placeholder="Họ và tên *" required />
      <input id="username" type="text" placeholder="Tên đăng nhập *" required />
      <input id="password" type="password" placeholder="Mật khẩu *" required />
      <input id="phone" type="text" placeholder="Số điện thoại" />
      <button id="registerBtn" type="button" class="btn">Đăng ký</button>
      <button type="button" class="btn ghost" onclick="location.href='login.html'">Trở lại</button>
      <p class="small-muted">Tạo tài khoản để quản lý sản phẩm của bạn.</p>
    </form>
  </div>

  <script>
    async function saveLocalUser(user){
      let users = JSON.parse(localStorage.getItem("users") || "[]");
      users.push(user);
      localStorage.setItem("users", JSON.stringify(users));
    }

    document.getElementById("registerBtn").addEventListener("click", async () => {
      const fullname = document.getElementById("fullname").value.trim();
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      const phone = document.getElementById("phone").value.trim();

      if (!fullname || !username || !password) {
        alert("Vui lòng nhập đầy đủ thông tin bắt buộc.");
        return;
      }

      let users = JSON.parse(localStorage.getItem("users") || "[]");
      if (users.some(u => u.username === username)) {
        alert("Tên đăng nhập đã tồn tại.");
        return;
      }

      const newUser = { fullname, username, password, phone, avatar: "" };

      try {
        const res = await fetch('/api/register', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(newUser)
        });
        if (res.ok) {
          const created = await res.json();
          await saveLocalUser(created);
          alert("Đăng ký thành công! Hãy đăng nhập.");
          location.href = "login.html";
          return;
        }
      } catch (e) {
        console.error("Lỗi API:", e);
      }

      await saveLocalUser(newUser);
      alert("Đăng ký thành công (local). Hãy đăng nhập.");
      location.href = "login.html";
    });
  </script>
</body>
</html>
