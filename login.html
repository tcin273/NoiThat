<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ƒêƒÉng nh·∫≠p - ƒê·ªì N·ªôi Th·∫•t Store</title>
  <style>
    :root { --muted:#666; }

    body {
      margin:0;
      font-family: Inter, Arial, sans-serif;
      background:#fff7ec;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
    }

    .login-box {
      background:#fff;
      padding:24px;
      border-radius:12px;
      box-shadow:0 10px 30px rgba(0,0,0,.1);
      width:100%;
      max-width:340px;
      text-align:center;
    }

    .login-box h1 {
      font-size:22px;
      margin-bottom:8px;
    }

    .login-box h2 {
      font-size:18px;
      margin-bottom:16px;
      color:#333;
    }

    .login-form input {
      width:100%;
      padding:10px;
      margin-bottom:12px;
      border:1px solid #ccc;
      border-radius:8px;
      font-size:14px;
    }

    .btn {
      width:100%;
      padding:10px;
      margin-bottom:8px;
      border:none;
      border-radius:8px;
      background:#ff7a00;
      color:#fff;
      font-weight:bold;
      cursor:pointer;
      transition:opacity .3s;
    }

    .btn:hover { opacity:.9; }

    .btn.ghost {
      background:#fff;
      border:2px solid #111;
      color:#111;
    }

    .small-muted {
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
    }
  </style>
</head>
<body>
  <div class="login-box">
    <h1>üõãÔ∏è ƒê·ªì N·ªôi Th·∫•t Store</h1>
    <h2>ƒêƒÉng nh·∫≠p</h2>
    <form class="login-form">
      <input id="username" type="text" placeholder="T√™n ƒëƒÉng nh·∫≠p" autocomplete="username" required />
      <input id="password" type="password" placeholder="M·∫≠t kh·∫©u" autocomplete="current-password" required />
      <button id="loginBtn" type="button" class="btn">ƒêƒÉng nh·∫≠p</button>
      <button type="button" class="btn ghost" onclick="location.href='register.html'">ƒêƒÉng k√Ω</button>
      <p class="small-muted">ƒêƒÉng nh·∫≠p ƒë·ªÉ qu·∫£n l√Ω s·∫£n ph·∫©m c·ªßa b·∫°n.</p>
    </form>
  </div>

  <script>
    async function fallbackLocalLogin(username, password){
      const users = JSON.parse(localStorage.getItem("users") || "[]");
      return users.find(u => u.username === username && u.password === password) || null;
    }

    document.getElementById("loginBtn").addEventListener("click", async () => {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!username || !password) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
        return;
      }

      try {
        const res = await fetch('/api/login', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ username, password })
        });

        if (res.ok) {
          const user = await res.json();
          localStorage.setItem("currentUser", JSON.stringify(user));
          location.href = "index.html";
          return;
        }
      } catch (e) {
        console.error("L·ªói API:", e);
      }

      const user = await fallbackLocalLogin(username, password);
      if (user) {
        localStorage.setItem("currentUser", JSON.stringify(user));
        location.href = "index.html";
      } else {
        alert("Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u!");
      }
    });

    (function checkLogin(){
      const u = JSON.parse(localStorage.getItem("currentUser") || "null");
      if (u && u.username) location.href = "index.html";
    })();
  </script>
</body>
</html>
